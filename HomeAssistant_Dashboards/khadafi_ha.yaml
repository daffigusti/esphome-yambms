views:
  - title: Home
    cards:
      - type: entities
        entities:
          - zone.home
          - conversation.home_assistant
      - type: entities
        entities:
          - entity: sensor.energy_consumption
            secondary_info: entity-id
            icon: mdi:flash
        state_color: false
        show_header_toggle: true
      - type: gauge
        entity: sensor.daly_bms_ble_daly_bms_ble_state_of_charge
        needle: true
        min: 20
        max: 80
        segments:
          - from: 0
            color: "#db4437"
          - from: 35
            color: "#ffa600"
          - from: 40
            color: "#43a047"
          - from: 60
            color: "#ffa600"
          - from: 65
            color: "#db4437"
        name: Daly SOC Baterai
      - type: entities
        entities:
          - sensor.daly_bms_ble_daly_bms_ble_total_voltage
      - type: entities
        entities:
          - entity: select.inverter_solar_panel_ac_voltage_range
            name: AC Voltage Range
          - entity: >-
              select.inverter_solar_panel_charge_back_voltage_after_floating_charging
            name: Charge Back Voltage after Floating Charging
          - entity: select.inverter_solar_panel_charge_source_priority
            name: Charge Source Priority
          - entity: select.inverter_solar_panel_battery_boost_charge_voltage
            name: Boost Charge Voltage
          - entity: select.inverter_solar_panel_floating_charging_voltage
            name: Floating Charging Voltage
          - entity: select.inverter_solar_panel_output_source_priority
            name: Output Source Priority
          - entity: select.inverter_solar_panel_voltage_switch_to_ac
            name: Voltage Swith to AC
          - entity: select.inverter_solar_panel_voltage_swith_to_inverter
            name: Voltage Swith to Inverter
        title: Inverter Solar Panel
      - type: entities
        entities:
          - entity: button.yambms_esp32_restart
            name: Yambms ESP32 Restart
          - entity: number.yambms_yambms_1_bulk_voltage
            name: Yambms YamBMS 1 Bulk voltage
          - entity: switch.yambms_yambms_1_charge_enabled
            name: Yambms YamBMS 1 Charge enabled
          - entity: switch.yambms_yambms_1_discharge_enabled
            name: Yambms YamBMS 1 Discharge enabled
          - entity: switch.yambms_yambms_1_eoc_timer_enabled
            name: Yambms YamBMS 1 EOC Timer enabled
          - entity: switch.yambms_yambms_1_float_charge_enabled
            name: Yambms YamBMS 1 Float charge enabled
          - entity: number.yambms_yambms_1_float_voltage
            name: Yambms YamBMS 1 Float voltage
          - entity: switch.yambms_yambms_1_force_bulk_top_bal
            name: Yambms YamBMS 1 Force Bulk (top bal)
          - entity: number.yambms_yambms_1_inverter_offset_v
            name: Yambms YamBMS 1 Inverter Offset V.
          - entity: number.yambms_yambms_1_max_charge_current
            name: Yambms YamBMS 1 Max charge current (%)
          - entity: number.yambms_yambms_1_max_discharge_current
            name: Yambms YamBMS 1 Max discharge current (%)
          - entity: number.yambms_yambms_1_rebulk_soc
            name: Yambms YamBMS 1 Rebulk SoC
          - entity: number.yambms_yambms_1_rebulk_v
            name: Yambms YamBMS 1 Rebulk V.
          - entity: switch.yambms_yambms_1_request_force_charge
            name: Yambms YamBMS 1 Request force charge
          - entity: number.yambms_yambms_1_request_force_charge_start_soc
            name: Yambms YamBMS 1 Request Force Charge Start SoC
          - entity: number.yambms_yambms_1_request_force_charge_stop_soc
            name: Yambms YamBMS 1 Request Force Charge Stop SoC
        title: Yambms
  - type: sections
    max_columns: 4
    title: My Power
    path: my-power
    sections:
      - type: grid
        cards:
          - type: custom:sunsynk-power-flow-card
            cardstyle: full
            wide: true
            solar:
              mppts: 1
              show_daily: true
              max_power: 4400
              auto_scale: true
              display_mode: 3
              efficiency: 3
              animation_speed: 5
              pv1_max_power: 4400
              pv2_max_power: 0
              off_threshold: 0
            battery:
              shutdown_soc: 20
              show_daily: true
              count: 1
              invert_power: true
              auto_scale: true
              max_power: 4400
              energy: 16800
            battery2:
              energy: 4800
              invert_power: true
              auto_scale: true
              shutdown_soc: 20
            load:
              show_daily: true
              dynamic_colour: false
              max_power: 4400
              load1_name: Lantai 1
              load2_name: Lantai 2
              animation_speed: 4
              show_daily_aux: true
              aux_load: 1
              aux_load_1_name: Lantai 1
              additional_loads: 2
              auto_scale: true
              essential_name: Rumah
            grid:
              show_daily_buy: true
              show_nonessential: false
              invert_grid: true
            entities:
              pv1_power_186: sensor.inverter_solar_panel_pv_power
              pv1_voltage_109: sensor.inverter_solar_panel_pv_voltage
              pv1_current_110: sensor.inverter_solar_panel_pv_current
              day_pv_energy_108: sensor.inverter_solar_panel_today_production
              pv_total: sensor.inverter_solar_panel_total_production
              remaining_solar: sensor.energy_production_today_remaining_2
              total_pv_generation: sensor.inverter_solar_panel_total_production
              inverter_voltage_154: sensor.inverter_solar_panel_inverter_voltage
              load_frequency_192: sensor.inverter_solar_panel_inverter_frequency
              inverter_current_164: sensor.inverter_solar_panel_inverter_current
              inverter_power_175: sensor.inverter_solar_panel_consumption_power
              grid_power_169: none
              grid_ct_power_172: sensor.inverter_solar_panel_grid_active_power_1
              day_aux_energy: sensor.energy_consumption
              day_battery_charge_70: sensor.battery_daily_charge
              day_battery_discharge_71: sensor.battery_daily_discharge
              battery_voltage_183: sensor.inverter_solar_panel_battery_voltage
              battery_soc_184: sensor.yambms_yambms_1_battery_soc
              battery_power_190: sensor.yambms_yambms_1_battery_charging_power
              battery_current_191: sensor.inverter_solar_panel_battery_current
              battery_temp_182: sensor.yambms_yambms_1_max_temperature
              battery2_power_190: sensor.yambms_smartli_bms_2_power
              battery2_current_191: sensor.yambms_smartli_bms_2_current
              battery2_voltage_183: sensor.yambms_smartli_bms_2_total_voltage
              battery2_soc_184: sensor.yambms_smartli_bms_2_state_of_charge
              battery2_temp_182: sensor.yambms_smartli_bms_2_mosfet_temperature
              day_load_energy_84: sensor.inverter_solar_panel_today_load_consumption
              day_grid_import_76: sensor.inverter_solar_panel_today_energy_import
              inverter_status_59: sensor.inverter_solar_panel_device_state
              radiator_temp_91: sensor.inverter_solar_panel_inverter_radiator_temperature
              dc_transformer_temp_90: sensor.inverter_solar_panel_transformer_temperature
              battery_status: 1
              grid_connected_status_194: Grid/Off Grid
              nonessential_power: none
              essential_load1_extra: sensor.energy_consumption
              essential_load2_extra: sensor.energy_consumption_2
              priority_load_243: switch.inverter_solar_panel_switch_to_grid_on_or_battery_off
            large_font: false
            show_solar: true
            show_battery: true
            show_grid: true
            grid_options:
              columns: full
            inverter:
              modern: true
              model: goodwe
              auto_scale: true
              autarky: power
            dynamic_line_width: true
          - type: entities
            entities:
              - entity: sensor.yambms_jk_bms_1_battery_soc
              - entity: sensor.yambms_jk_bms_1_power
              - entity: sensor.yambms_jk_bms_1_total_voltage
              - entity: sensor.yambms_jk_bms_1_errors
              - entity: sensor.yambms_jk_bms_1_current
            title: Daly BMS Status
            state_color: true
          - type: entities
            entities:
              - entity: sensor.yambms_smartli_bms_2_battery_soc
              - entity: sensor.yambms_smartli_bms_2_power
              - entity: sensor.yambms_smartli_bms_2_total_voltage
              - entity: sensor.yambms_smartli_bms_2_bms_alarm_status_2
              - entity: sensor.yambms_smartli_bms_3_bms_protection_status
            title: Smart LI 2 Battery Status
            state_color: true
          - type: entities
            entities:
              - entity: sensor.yambms_smartli_bms_3_battery_soc
              - entity: sensor.yambms_smartli_bms_3_power
              - entity: sensor.yambms_smartli_bms_3_total_voltage
              - entity: sensor.yambms_smartli_bms_3_bms_alarm_status_2
              - entity: sensor.yambms_smartli_bms_2_bms_protection_status
            title: Smart LI 3 Battery Status
            state_color: true
          - type: custom:power-flow-card-plus
            entities:
              battery:
                state_of_charge: sensor.inverter_solar_panel_battery
                entity: sensor.inverter_battery_load_power
                invert_state: true
              solar:
                entity: sensor.inverter_solar_panel_pv_power
                display_zero_state: true
                secondary_info: {}
              grid:
                secondary_info: {}
                entity: sensor.grid_power
                invert_state: false
                display_state: one_way_no_zero
              home:
                secondary_info: {}
                override_state: true
                subtract_individual: false
                entity: sensor.inverter_solar_panel_consumption_power
            clickable_entities: true
            display_zero_lines:
              mode: hide
              transparency: 50
              grey_color:
                - 189
                - 189
                - 189
            use_new_flow_rate_model: true
            w_decimals: 0
            kw_decimals: 1
            min_flow_rate: 0.75
            max_flow_rate: 6
            max_expected_power: 2000
            min_expected_power: 0.01
            watt_threshold: 1000
            transparency_zero_lines: 0
            disable_dots: false
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.energy_consumption
            name: LT1 CONSUMPTION
            show:
              graph: bar
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.energy_consumption_2
            name: LT 2 CONSUMPTION
            show:
              graph: bar
          - show_current: true
            show_forecast: true
            type: weather-forecast
            entity: weather.forecast_home
            forecast_type: daily
            grid_options:
              columns: 24
              rows: 4
        column_span: 2
      - type: grid
        cards:
          - type: custom:mini-graph-card
            entities:
              - sensor.inverter_solar_panel_pv_power
            show:
              labels: true
            color_thresholds:
              - value: 500
                color: "#f39c12"
              - value: 1000
                color: "#d35400"
              - value: 1500
                color: "#c0392b"
          - type: custom:mini-graph-card
            entities:
              - sensor.inverter_solar_panel_consumption_power
            show:
              labels: true
            color_thresholds:
              - value: 500
                color: "#f39c12"
              - value: 1000
                color: "#d35400"
              - value: 1500
                color: "#c0392b"
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.grid_power
            name: PLN CONSUMPTION
            show:
              graph: bar
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.inverter_solar_panel_consumption_power
            name: Energy consumption
            hours_to_show: 168
            aggregate_func: max
            group_by: date
            show:
              graph: bar
          - square: true
            type: grid
            cards:
              - type: gauge
                entity: sensor.yambms_jk_bms_1_total_voltage
                min: 44
                max: 54
                needle: true
                severity:
                  green: 48
                  yellow: 46
                  red: 44
                name: JK Batt
              - type: gauge
                entity: sensor.yambms_smartli_bms_2_total_voltage
                max: 54
                name: Smart LI
                min: 44
                needle: true
                severity:
                  green: 48
                  yellow: 46
                  red: 44
              - type: gauge
                entity: sensor.yambms_smartli_bms_3_total_voltage
                name: Smart LI 2
                min: 44
                max: 54
                needle: true
                severity:
                  green: 48
                  yellow: 46
                  red: 44
            columns: 3
            grid_options:
              columns: 12
              rows: 2
          - type: tile
            entity: sensor.inverter_solar_panel_battery_state
            grid_options:
              columns: 12
              rows: 1
          - type: tile
            entity: sensor.inverter_solar_panel_device_state
            grid_options:
              columns: 12
              rows: 1
          - type: tile
            entity: sensor.yambms_jk_bms_1_power
            name: Batt 1 Power
            show_entity_picture: false
            vertical: false
            hide_state: false
            state_content:
              - state
              - last_changed
          - type: tile
            entity: sensor.yambms_smartli_bms_2_power
            name: Batt 2 Power
            state_content:
              - state
              - last_changed
            grid_options:
              columns: 9
              rows: 1
          - type: tile
            entity: sensor.yambms_smartli_bms_3_power
            name: Batt 3 Power
            state_content:
              - state
              - last_changed
            grid_options:
              columns: 9
              rows: 1
          - type: horizontal-stack
            cards:
              - type: custom:bar-card
                rows: 5
                entities:
                  - entity: sensor.yambms_jk_bms_1_total_voltage
                    name: 1
                    icon: mdi:battery-70
                  - entity: sensor.yambms_smartli_bms_2_total_voltage
                    name: 2
                    icon: mdi:battery-70
                  - entity: sensor.yambms_smartli_bms_3_total_voltage
                    name: 3
                    icon: mdi:battery-70
                title: null
                height: 100%
                width: 100%
                show icon: true
                min: 48
                max: 51
                decimal: 1
                stack: vertical
                positions:
                  icon: "off"
                severity:
                  - from: "0"
                    to: "45"
                    color: red
                  - from: "45.01"
                    to: "47.25"
                    color: yellow
                  - from: "47.26"
                    to: "50.25"
                    color: green
                  - from: "50.26"
                    to: "50.63"
                    color: yellow
                  - from: "50.64"
                    to: "54.75"
                    color: red
                card_mod:
                  style: |
                    ha-card {
                      --ha-card-header-font-size: 16px;
                    }
                    bar-card-row:nth-of-type(1) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(2) bar-card-name {
                        color: black;
                    }                 
                    bar-card-row:nth-of-type(3) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(4) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(5) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(6) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(7) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(8) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(9) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(10) bar-card-name {
                        color: black;
                    }      
                    bar-card-row:nth-of-type(11) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(12) bar-card-name {
                        color: black;
                    }
                entity_row: true
              - type: custom:bar-card
                entities:
                  - entity: sensor.yambms_jk_bms_1_current
                    name: 1
                    icon: mdi:battery
                  - entity: sensor.yambms_smartli_bms_2_current
                    name: 2
                    icon: mdi:battery
                  - entity: sensor.yambms_smartli_bms_3_current
                    name: 3
                    icon: mdi:battery
                severity:
                  - from: "0"
                    color: null
                    to: "0"
                  - from: "-100"
                    color: red
                    to: "-0.1"
                  - from: "0.1"
                    to: 100
                    color: green
                rows: 12
                title: null
                direction: right
                height: 100%
                width: 100%
                min: -12
                max: 12
                decimal: 1
                stack: vertical
                positions:
                  icon: "off"
                title_position: inside
                icon_position: inside
                card_mod:
                  style: |
                    ha-card {
                      --ha-card-header-font-size: 16px;
                    }
                    bar-card-row:nth-of-type(1) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(2) bar-card-name {
                        color: black;
                    }                 
                    bar-card-row:nth-of-type(3) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(4) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(5) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(6) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(7) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(8) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(9) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(10) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(11) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(12) bar-card-name {
                        color: black;
                    } 
                    bar-card-title bar-card-title{
                        color: black;
                    }
                    bar-card-title bar-card-title{
                        color: white;
                    }
                entity_row: true
              - type: custom:bar-card
                rows: 12
                entities:
                  - entity: sensor.yambms_jk_bms_1_power
                    name: 1
                    icon: mdi:battery-70
                  - entity: sensor.yambms_smartli_bms_2_power
                    name: 2
                    icon: mdi:battery-70
                  - entity: sensor.yambms_smartli_bms_3_power
                    name: 3
                    icon: mdi:battery-70
                title: null
                height: 100%
                width: 100%
                show icon: true
                min: -555
                max: 555
                decimal: 0
                stack: vertical
                positions:
                  icon: "off"
                severity:
                  - from: "0"
                    color: null
                    to: "0"
                  - from: "-4400"
                    color: red
                    to: "-0.1"
                  - from: "0.1"
                    to: 4400
                    color: green
                card_mod:
                  style: |
                    ha-card {
                      --ha-card-header-font-size: 16px;
                    }
                    bar-card-row:nth-of-type(1) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(2) bar-card-name {
                        color: black;
                    }                 
                    bar-card-row:nth-of-type(3) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(4) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(5) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(6) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(7) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(8) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(9) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(10) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(11) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(12) bar-card-name {
                        color: black;
                    }
                entity_row: true
              - type: custom:bar-card
                rows: 12
                entities:
                  - entity: sensor.yambms_jk_bms_1_battery_soc
                    name: 1
                    icon: mdi:battery-70
                  - entity: sensor.yambms_smartli_bms_2_state_of_charge
                    name: 2
                    icon: mdi:battery-70
                  - entity: sensor.yambms_smartli_bms_3_state_of_charge
                    name: 3
                    icon: mdi:battery-70
                title: null
                height: 100%
                width: 100%
                show icon: true
                min: 0
                max: 100
                decimal: 1
                stack: vertical
                positions:
                  icon: "off"
                severity:
                  - from: "0"
                    to: "9.5"
                    color: red
                  - from: "9.51"
                    to: "14"
                    color: yellow
                  - from: "14.01"
                    to: "90"
                    color: green
                  - from: "90.01"
                    to: "98.99"
                    color: yellow
                  - from: "99.0"
                    to: "100"
                    color: red
                card_mod:
                  style: |
                    ha-card {
                      --ha-card-header-font-size: 16px;
                    }
                    bar-card-row:nth-of-type(1) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(2) bar-card-name {
                        color: black;
                    }                 
                    bar-card-row:nth-of-type(3) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(4) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(5) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(6) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(7) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(8) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(9) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(10) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(11) bar-card-name {
                        color: black;
                    } 
                    bar-card-row:nth-of-type(12) bar-card-name {
                        color: black;
                    }
                entity_row: true
            grid_options:
              columns: 24
              rows: 2
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.inverter_solar_panel_pv_power
              - entity: sensor.inverter_solar_panel_today_production
                show_state: true
                show_graph: true
            icon: mdi:solar-panel
            show:
              extrema: true
              legend: true
              average: true
              fill: fade
            name: pv panel
            line_width: 2
            lower_bound: 0
            min_bound_range: 100
            points_per_hour: 10
            line_color: green
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.inverter_solar_panel_consumption_power
              - entity: sensor.inverter_solar_panel_today_load_consumption
                show_state: true
                show_graph: true
            icon: mdi:solar-panel
            show:
              extrema: true
              legend: true
              average: true
              fill: fade
            name: load stats
            line_width: 2
            lower_bound: 0
            min_bound_range: 100
            points_per_hour: 10
            line_color: green
          - type: custom:apexcharts-card
            header:
              show: true
              title: Daily PV Generation
              show_states: true
              colorize_states: true
            graph_span: 7d
            update_interval: 5min
            span:
              offset: +5.5h
              end: day
            series:
              - entity: sensor.inverter_solar_panel_today_production
                type: column
                color: "#FFA500"
                group_by:
                  func: max
                  duration: 1d
                show:
                  datalabels: true
                name: PV Generation (kWh)
          - type: custom:apexcharts-card
            header:
              show: true
              title: Daily Energy Consumption
              show_states: true
              colorize_states: true
            update_interval: 5min
            graph_span: 7d
            span:
              offset: +5.5h
              end: day
            series:
              - entity: sensor.inverter_solar_panel_today_production
                type: column
                name: PLTS (kWh)
                color: "#FFA500"
                group_by:
                  func: max
                  duration: 1d
                show:
                  datalabels: true
              - entity: sensor.inverter_solar_panel_today_energy_import
                type: column
                name: Grid (kWh)
                color: "#FF0000"
                group_by:
                  func: max
                  duration: 1d
                show:
                  datalabels: true
              - entity: sensor.inverter_solar_panel_today_load_consumption
                type: column
                name: Total (kWh)
                color: "#0080FF"
                group_by:
                  func: max
                  duration: 1d
                show:
                  datalabels: true
          - type: custom:apexcharts-card
            layout: full
            apex_config:
              chart:
                height: 290
                stacked: false
              xaxis:
                labels:
                  format: dd
              legend:
                show: true
              fill:
                type: gradient
                gradient:
                  type: vertical
                  shadeIntensity: 0.25
                  inverseColors: false
                  opacityFrom: 0.45
                  opacityTo: 1.5
                  stops:
                    - 10
                opacity: 2
              grid:
                show: true
                borderColor: eeeeee
                strokeDashArray: 3
                position: back
            graph_span: 7d1s
            span:
              offset: +5.5h
              end: day
            show:
              last_updated: false
            header:
              show: true
              show_states: true
              colorize_states: true
              title: BATTERY STATS
            series:
              - entity: sensor.battery_daily_charge
                name: CHARGE
                type: column
                unit: " KWh"
                color: 0e4c04
                group_by:
                  func: max
                  duration: 1d
                show:
                  datalabels: true
              - entity: sensor.battery_daily_discharge
                name: DISCHARGE
                type: column
                unit: " KWh"
                color: 3dfc1e
                group_by:
                  func: max
                  duration: 1d
                show:
                  datalabels: true
            style: |
              ha-card {border-radius: 29px; border: 0.2px solid teal }
          - square: true
            type: grid
            cards:
              - type: custom:apexcharts-card
                header:
                  show: true
                  title: Real-Time Power (W)
                  show_states: true
                  colorize_states: true
                graph_span: 1d
                update_interval: 30s
                now:
                  show: true
                yaxis:
                  - id: power
                    min: 0
                    apex_config:
                      tickAmount: 5
                all_series_config:
                  type: area
                  show:
                    legend_value: true
                  group_by:
                    func: avg
                    duration: 5min
                  opacity: 0.3
                series:
                  - entity: sensor.inverter_solar_panel_today_production
                    name: PLTS (W)
                    color: "#FFA500"
                  - entity: sensor.inverter_solar_panel_today_energy_import
                    name: Grid (W)
                    color: "#FF0000"
                  - entity: sensor.inverter_solar_panel_today_load_consumption
                    name: Total (W)
                    color: "#0080FF"
            columns: 1
          - type: custom:apexcharts-card
            graph_span: 3h
            apex_config:
              header:
                stacked: false
                height: 1024
              xaxis:
                show_states: true
                labels:
                  show: true
                  style:
                    fontSize: 11
                    fontWeight: 15
                  offsetY: -4
                  axisTicks:
                    show: false
                tooltip:
                  enabled: true
              legend:
                show: true
                style:
                  fontSize: 8
                  fontWeight: 8
                offsetY: -5
                colorize_states: true
                show_states: true
            show:
              last_updated: true
            yaxis:
              - min: 0
                max: 5000
                decimals: 0
                apex_config:
                  tickAmount: 8
                  stroke:
                    width: 0
                  labels:
                    style:
                      fontSize: 10px
                    offsetX: 0
                    offsetY: 0
            header:
              show: false
              colorize_states: true
              title: PV Production
            series:
              - entity: sensor.inverter_solar_panel_pv_power
                type: line
                name: inputpv
                color: a83277
                group_by:
                  func: last
                  duration: 15m
                stroke_width: 1
                show:
                  header_color_threshold: false
                  extremas: true
                  in_chart: true
                  in_header: false
                  legend_value: false
              - entity: sensor.inverter_solar_panel_consumption_power
                type: column
                name: power inv
                color: rgb(0, 150, 130)
                group_by:
                  func: avg
                  duration: 15m
                stroke_width: 2
                show:
                  header_color_threshold: false
                  extremas: true
                  in_chart: true
                  in_header: true
                  legend_value: false
              - entity: sensor.inverter_solar_panel_grid_active_power_1
                type: column
                name: import
                color: rgb(150, 50, 50)
                group_by:
                  func: last
                  duration: 15m
                stroke_width: 1
                show:
                  header_color_threshold: false
                  extremas: true
                  in_chart: true
                  in_header: true
                  legend_value: false
              - entity: sensor.yambms_yambms_1_power_s
                type: column
                name: battery charge
                color: rgb(50, 40, 120)
                group_by:
                  func: last
                  duration: 15m
                stroke_width: 2
                show:
                  header_color_threshold: false
                  extremas: true
                  in_chart: true
                  in_header: true
                  legend_value: false
        column_span: 2
    badges: []
  - title: YamBMS
    type: sections
    max_columns: 3
    sections:
      - type: grid
        cards:
          - type: heading
            heading: YamBMS - Battery
          - graph: line
            type: sensor
            entity: sensor.yambms_yambms_1_total_voltage
            detail: 2
            layout_options:
              grid_columns: 2
              grid_rows: 2
            name: Voltage
            hours_to_show: 8
          - graph: line
            type: sensor
            entity: sensor.yambms_yambms_1_battery_soc
            detail: 2
            name: SoC
            hours_to_show: 8
          - type: gauge
            entity: sensor.yambms_yambms_1_current
            needle: true
            severity:
              green: 0
              yellow: -250
              red: -500
            max: 500
            min: -500
            name: Current
            layout_options:
              grid_columns: 2
              grid_rows: 3
          - type: gauge
            entity: sensor.yambms_yambms_1_power
            needle: true
            severity:
              green: 0
              yellow: -2500
              red: -5000
            max: 5000
            min: -5000
            name: Power
            layout_options:
              grid_columns: 2
              grid_rows: 3
          - type: tile
            entity: sensor.yambms_yambms_1_installed_battery_capacity
            name: Installed Battery Capacity
          - type: tile
            entity: sensor.yambms_yambms_1_battery_soh
            name: Battery SoH
          - type: tile
            entity: sensor.yambms_yambms_1_battery_capacity
            name: Battery Capacity
          - type: tile
            entity: sensor.yambms_yambms_1_capacity_remaining
            name: Capacity Remaining
          - type: tile
            entity: sensor.yambms_yambms_1_delta_cell_voltage
            name: Delta Cell Voltage
          - type: tile
            entity: binary_sensor.yambms_yambms_1_bms_equalizing_state
            name: Equalizing state
          - type: entities
            entities:
              - entity: sensor.yambms_yambms_1_max_cell_voltage
                name: Max Cell V.
              - entity: sensor.yambms_yambms_1_max_voltage_cell
                name: Cell number
            layout_options:
              grid_columns: 2
              grid_rows: 2
          - type: entities
            entities:
              - entity: sensor.yambms_yambms_1_min_cell_voltage
                name: Min Cell V.
              - entity: sensor.yambms_yambms_1_min_voltage_cell
                name: Cell number
            layout_options:
              grid_columns: 2
              grid_rows: 2
          - type: entities
            entities:
              - entity: sensor.yambms_yambms_1_max_temperature
                name: Max temp.
              - entity: sensor.yambms_yambms_1_max_temperature_sensor
                name: Sensor number
            layout_options:
              grid_columns: 2
              grid_rows: 2
          - type: entities
            entities:
              - entity: sensor.yambms_yambms_1_min_temperature
                name: Min temp.
              - entity: sensor.yambms_yambms_1_min_temperature_sensor
                name: Sensor number
            layout_options:
              grid_columns: 2
              grid_rows: 2
        column_span: 1
      - type: grid
        cards:
          - type: heading
            heading: YamBMS - Status
          - type: tile
            entity: binary_sensor.yambms_inverter_communication_status
            name: Inverter comm. status
          - type: tile
            entity: binary_sensor.yambms_esp32_online_status
            name: ESP32 status
          - type: tile
            entity: sensor.yambms_yambms_1_charging_status
            name: Charging Status
          - type: tile
            entity: sensor.yambms_yambms_1_last_complete_charge
            name: Last Complete Charge
          - type: tile
            entity: sensor.yambms_yambms_1_charging_instruction
            name: Charging Instruction
          - type: tile
            entity: binary_sensor.yambms_yambms_1_discharging_instruction
            name: Discharging Instruction
          - type: tile
            entity: sensor.yambms_yambms_1_alarm
            name: Alarm
          - type: tile
            entity: sensor.yambms_yambms_1_warning
            name: Warning
          - type: entities
            entities:
              - entity: sensor.yambms_yambms_1_bms_count
                name: BMS count
              - entity: sensor.yambms_yambms_1_bms_combined
                name: BMS combined
              - entity: sensor.yambms_yambms_1_bms_blocking_charge
                name: BMS blocking charge
              - entity: sensor.yambms_yambms_1_bms_blocking_discharge
                name: BMS blocking discharge
              - entity: sensor.yambms_yambms_1_bms_in_alarm
                name: BMS in alarm
            layout_options:
              grid_columns: 2
              grid_rows: 4
          - type: entities
            entities:
              - entity: sensor.yambms_yambms_1_shunt_count
                name: Shunt count
              - entity: sensor.yambms_yambms_1_shunt_combined
                name: Shunt combined
            layout_options:
              grid_columns: 2
              grid_rows: 2
          - type: tile
            entity: sensor.yambms_esp32_uptime
            name: ESP32 Uptime
          - type: tile
            entity: sensor.yambms_esp32_esphome_version
            name: ESPHome version
          - type: entities
            entities:
              - entity: sensor.yambms_yambms_1_requested_charge_voltage
                name: Requested Charge Voltage
              - entity: sensor.yambms_yambms_1_requested_charge_current
                name: Requested Charge Current
              - entity: sensor.yambms_yambms_1_requested_discharge_voltage
                name: Requested Discharge Voltage
              - entity: sensor.yambms_yambms_1_requested_discharge_current
                name: Requested Discharge Current
              - entity: binary_sensor.yambms_yambms_1_requested_force_charge
                name: Requested Force Charge
          - type: tile
            entity: sensor.yambms_yambms_1_running_version
            name: Running version
          - type: tile
            entity: sensor.yambms_yambms_1_last_version
            name: Last version
        column_span: 1
  - title: Control
    cards:
      - type: entity-filter
        entities:
          - entity: select.yambms_canbus_1_bms_name
            name: CANBUS 1 BMS Name
          - entity: select.yambms_canbus_1_protocol
            name: CANBUS 1 Protocol
          - entity: select.yambms_rs485_1_protocol
            name: RS485 1 Protocol
        conditions:
          - condition: state
            state_not: unavailable
        card:
          title: YamBMS - Inverter Comm. Protocol
      - type: entities
        entities:
          - entity: switch.yambms_yambms_1_charge_enabled
            name: YamBMS 1 Charge enabled
          - entity: switch.yambms_yambms_1_discharge_enabled
            name: YamBMS 1 Discharge enabled
          - entity: binary_sensor.yambms_yambms_1_bms_charging_allowed
            name: YamBMS 1 BMS Charging allowed
          - entity: binary_sensor.yambms_yambms_1_bms_discharging_allowed
            name: YamBMS 1 BMS Discharging allowed
        title: YamBMS - Charge / Discharge switch
      - type: entities
        entities:
          - entity: switch.yambms_yambms_1_automatic_charge_voltage
            name: Automatic Charge Voltage
          - entity: number.yambms_yambms_1_auto_cvl_boost_charge_v
            name: Auto CVL Boost Charge V.
        title: YamBMS - Auto CVL
      - type: entities
        entities:
          - entity: sensor.yambms_yambms_1_charging_status
            name: Charging Status
          - entity: sensor.yambms_yambms_1_charging_instruction
            name: Charging Instruction
          - entity: switch.yambms_yambms_1_float_charge_enabled
            name: Float charge enabled
          - entity: switch.yambms_yambms_1_eoc_timer_enabled
            name: EOC timer enabled
          - entity: number.yambms_yambms_1_bulk_voltage
            name: Bulk voltage
          - entity: number.yambms_yambms_1_float_voltage
            name: Float voltage
          - entity: number.yambms_yambms_1_inverter_offset_v
            name: Inverter Offset V.
        title: YamBMS - Charging Settings
      - type: entities
        entities:
          - entity: switch.yambms_yambms_1_automatic_charge_current
            name: Automatic Charge Current
          - entity: switch.yambms_yambms_1_automatic_discharge_current
            name: Automatic Discharge Current
        title: YamBMS - Auto CCL / DCL
      - type: entities
        entities:
          - entity: select.yambms_yambms_1_automatic_float_voltage
            name: Automatic Float Voltage
          - entity: sensor.yambms_yambms_1_auto_float_voltage
            name: Auto Float Voltage
          - entity: number.yambms_yambms_1_auto_float_update_interval
            name: Update Interval
          - entity: number.yambms_yambms_1_auto_float_voltage_step
            name: Voltage Step
        title: YamBMS - Auto Float
      - type: entities
        entities:
          - entity: number.yambms_yambms_1_rebulk_soc
            name: Rebulk SoC
          - entity: number.yambms_yambms_1_rebulk_v
            name: Rebulk V.
          - entity: switch.yambms_yambms_1_force_bulk_top_bal
            name: Force Bulk (top bal)
        title: YamBMS - ReBulk
      - type: entities
        entities:
          - entity: number.yambms_yambms_1_max_charge_current_percent
            name: Max charge current (%)
          - entity: number.yambms_yambms_1_max_discharge_current_percent
            name: Max discharge current (%)
        title: YamBMS - Max current (%)
      - type: entities
        entities:
          - entity: switch.yambms_yambms_1_request_force_charge
            name: Request force charge
          - entity: number.yambms_yambms_1_request_force_charge_start_soc
            name: Force charge Start SoC
          - entity: number.yambms_yambms_1_request_force_charge_stop_soc
            name: Force charge Stop SoC
          - entity: binary_sensor.yambms_yambms_1_requested_force_charge
            name: Requested Force Charge
        title: YamBMS - Request force charge
      - type: entities
        entities:
          - entity: sensor.yambms_yambms_1_requested_charge_voltage
            name: Requested Charge Voltage
          - entity: sensor.yambms_yambms_1_requested_discharge_voltage
            name: Requested Discharge Voltage
          - entity: sensor.yambms_yambms_1_requested_charge_current
            name: Requested Charge Current
          - entity: sensor.yambms_yambms_1_requested_discharge_current
            name: Requested Discharge Current
        title: YamBMS - Requested Values
      - type: entities
        entities:
          - entity: sensor.yambms_yambms_1_last_complete_charge
            name: Last Complete Charge
          - entity: binary_sensor.yambms_esp32_online_status
            name: ESP32 Online Status
          - entity: sensor.yambms_esp32_uptime
            name: ESP32 Uptime
          - entity: sensor.yambms_esp32_esphome_version
            name: ESP32 ESPHome version
          - entity: button.yambms_esp32_restart
            name: ESP32 Restart
        title: YamBMS - Diagnostic
      - type: entity-filter
        entities:
          - entity: binary_sensor.yambms_canbus_1_status
            name: CANBUS 1 Status
          - entity: switch.yambms_canbus_1_inverter_heartbeat_monitoring
            name: CANBUS 1 Inverter Heartbeat Monitoring
          - entity: sensor.yambms_canbus_1_inverter_heartbeat
            name: CANBUS 1 Inverter Heartbeat
          - entity: binary_sensor.yambms_rs485_1_status
            name: RS485 1 Status
          - entity: switch.yambms_rs485_1_inverter_heartbeat_monitoring
            name: RS485 1 Inverter Heartbeat Monitoring
          - entity: sensor.yambms_rs485_1_inverter_heartbeat
            name: RS485 1 Inverter Heartbeat
        conditions:
          - condition: state
            state_not: unavailable
        card:
          title: YamBMS - Inverter Status & Heartbeat
      - type: entity-filter
        entities:
          - entity: sensor.yambms_debug_free_psram_percent
            name: Debug Free PSRAM (%)
          - entity: sensor.yambms_debug_free_psram
            name: Debug Free PSRAM
          - entity: sensor.yambms_debug_heap_free_percent
            name: Debug Heap free (%)
          - entity: sensor.yambms_debug_heap_free
            name: Debug Heap free
          - entity: sensor.yambms_debug_heap_max_block_percent
            name: Debug Heap max block (%)
          - entity: sensor.yambms_debug_heap_max_block
            name: Debug Heap max block
          - entity: sensor.yambms_debug_loop_time
            name: Debug Loop time
          - entity: sensor.yambms_esp32_uptime
            name: ESP32 Uptime
          - entity: sensor.yambms_esp32_esphome_version
            name: ESPHome version
          - entity: sensor.yambms_debug_reset_reason
            name: Debug Reset reason
        conditions:
          - condition: state
            state_not: unavailable
        card:
          title: YamBMS - DEBUG
  - title: BMS
    type: sections
    max_columns: 3
    sections:
      - type: grid
        column_span: 1
        cards:
          - type: heading
            heading: BMS 1
            heading_style: title
            badges:
              - type: entity
                show_state: true
                show_icon: true
                entity: binary_sensor.yambms_jk_bms_1_status_online
                color: state
                name: Online
                state_content: name
              - type: entity
                show_state: true
                show_icon: true
                entity: binary_sensor.yambms_jk_bms_1_can_be_combined
                color: state
                name: Combined
                state_content: name
          - type: grid
            square: false
            columns: 1
            cards:
              - type: markdown
                content: >-
                  <center>Time : <b><font color=red>{{
                  states('sensor.yambms_jk_bms_1_total_runtime_formatted', rounded=True)
                  | upper }}</font>
            layout_options:
              grid_columns: 2
              grid_rows: 1
          - type: grid
            square: false
            columns: 1
            cards:
              - type: markdown
                content: >-
                  <center>Error : <b><font color=red>{{
                  states('sensor.yambms_jk_bms_1_errors', rounded=True)}}</font>
            layout_options:
              grid_columns: 2
              grid_rows: 1
          - type: grid
            square: false
            columns: 3
            cards:
              - type: markdown
                content: >-
                  <center>Charge : <b>{% if
                  states('binary_sensor.yambms_jk_bms_1_status_charging', rounded=True) == 'on'
                  %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_1_status_charging', rounded=True) | upper
                  }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_1_status_charging', rounded=True) | upper
                  }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center>Discharge : <b> {% if
                  states('binary_sensor.yambms_jk_bms_1_status_discharging', rounded=True) ==
                  'on' %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_1_status_discharging', rounded=True) |
                  upper }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_1_status_discharging', rounded=True) |
                  upper }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center>Balance : <b> {% if
                  states('binary_sensor.yambms_jk_bms_1_status_balancing', rounded=True) ==
                  'on' %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_1_status_balancing', rounded=True) |
                  upper }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_1_status_balancing', rounded=True) |
                  upper }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_1_battery_voltage', rounded=True) }}
                  V</font></b>
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_1_battery_current', rounded=True) }} A</font></b>
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_1_battery_power', rounded=True) }} W</font>
          - type: grid
            square: false
            columns: 2
            cards:
              - type: markdown
                content: >-
                  <center><b><font size=4>SoC :&nbsp;&nbsp;<font
                  color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_1_battery_soc', rounded=True) }}
                  %</font></font>
              - type: markdown
                content: >-
                  <center><b><font size=4>SoH :&nbsp;&nbsp;<font
                  color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_1_battery_soh_valuation', rounded=True) }}
                  %</font></font>
              - type: markdown
                content: >-
                  <center> Battery Capacity :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('number.yambms_jk_bms_1_battery_capacity_total_setting', rounded=True)
                  }} Ah</font><br> Cycle Capacity :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_total_charging_cycle_capacity', rounded=True)
                  }} Ah</font><br> Ave. Cell Vol. :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_cell_average_voltage', rounded=True) }}
                  V</font><br> Balance Cur. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_balancing_current', rounded=True) }}
                  A</font><br> Max temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_max_temperature', rounded=True) }}
                  C</font>
              - type: markdown
                content: >-
                  <center> Remain Capacity :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_battery_capacity_remaining', rounded=True) }}
                  Ah</font><br> Cycle Count :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_charging_cycles', rounded=True)
                  }}</font><br> Delta Cell Vol. :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_cell_delta_voltage', rounded=True) }}
                  V</font><br> MOS temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_temperature_powertube', rounded=True)
                  }} C</font><br> Min temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_1_min_temperature', rounded=True) }}
                  C</font>
          - type: grid
            square: false
            columns: 2
            cards:
              - type: markdown
                content: >-
                  
                  {% macro cell_v(num, entity, max_color = 'red' , min_color = '#3090C9', lead_zero = 0, spaces=3) -%}
                  {% if lead_zero %}0{% endif %}{{num}}.{% for spaces in range(0, spaces) -%} {{ '&nbsp;' }} {%- endfor %}
                  {% if states('sensor{}_cell_voltage_max_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ max_color }}'>
                  {% elif states('sensor{}_cell_voltage_min_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ min_color }}'>
                  {% else %} <font> {% endif %}
                  
                  {{ states('sensor{}_cell_voltage_{}{}'.format(entity, ''.zfill(lead_zero), num), rounded=True) }} V</font>
                  {% if has_value('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num)) %} / 
                  {{ states('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num) , rounded=True) }}  {% endif %}
                  <br>
                  
                  {% endmacro %}
                  
                  <center>
                  
                  {{ cell_v(lead_zero=1, num=1, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=1, num=2, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=1, num=3, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=1, num=4, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=1, num=5, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=1, num=6, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=1, num=7, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=1, num=8, entity='.yambms_jk_bms_1') }}                  
                  
                  </center>
              - type: markdown
                content: >-
                  
                  {% macro cell_v(num, entity, max_color = 'red' , min_color = '#3090C9', lead_zero = 0, spaces=3) -%}
                  {% if lead_zero %}0{% endif %}{{num}}.{% for spaces in range(0, spaces) -%} {{ '&nbsp;' }} {%- endfor %}
                  {% if states('sensor{}_cell_voltage_max_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ max_color }}'>
                  {% elif states('sensor{}_cell_voltage_min_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ min_color }}'>
                  {% else %} <font> {% endif %}
                  
                  {{ states('sensor{}_cell_voltage_{}{}'.format(entity, ''.zfill(lead_zero), num), rounded=True) }} V</font>
                  {% if has_value('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num)) %} / 
                  {{ states('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num) , rounded=True) }}  {% endif %}
                  <br>
                  
                  {% endmacro %}
                  
                  <center>
                  
                  {{ cell_v(lead_zero=1, num=9, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=0, num=10, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=0, num=11, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=0, num=12, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=0, num=13, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=0, num=14, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=0, num=15, entity='.yambms_jk_bms_1') }}
                  {{ cell_v(lead_zero=0, num=16, entity='.yambms_jk_bms_1') }}              
                  
                  </center>
          - type: entity-filter
            entities:
              - entity: switch.yambms_jk_bms_1_charge_switch
                name: Charge switch
              - entity: switch.yambms_jk_bms_1_discharge_switch
                name: Discharge switch
              - entity: switch.yambms_jk_bms_1_balance_switch
                name: Balance switch
              - entity: switch.yambms_jk_bms_1_enable_bluetooth_connection
                name: Bluetooth
              - entity: number.yambms_jk_bms_1_charging_cycles_offset
                name: Charging Cycles Offset
            conditions:
              - condition: state
                state_not: unavailable
      - type: grid
        column_span: 1
        cards:
          - type: heading
            heading: BMS 2
            heading_style: title
            badges:
              - type: entity
                show_state: true
                show_icon: true
                entity: binary_sensor.yambms_jk_bms_2_status_online
                color: state
                name: Online
                state_content: name
              - type: entity
                show_state: true
                show_icon: true
                entity: binary_sensor.yambms_jk_bms_2_can_be_combined
                color: state
                name: Combined
                state_content: name
          - type: grid
            square: false
            columns: 1
            cards:
              - type: markdown
                content: >-
                  <center>Time : <b><font color=red>{{
                  states('sensor.yambms_jk_bms_2_total_runtime_formatted', rounded=True)
                  | upper }}</font>
            layout_options:
              grid_columns: 2
              grid_rows: 1
          - type: grid
            square: false
            columns: 1
            cards:
              - type: markdown
                content: >-
                  <center>Error : <b><font color=red>{{
                  states('sensor.yambms_jk_bms_2_errors', rounded=True)}}</font>
            layout_options:
              grid_columns: 2
              grid_rows: 1
          - type: grid
            square: false
            columns: 3
            cards:
              - type: markdown
                content: >-
                  <center>Charge : <b>{% if
                  states('binary_sensor.yambms_jk_bms_2_status_charging', rounded=True) == 'on'
                  %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_2_status_charging', rounded=True) | upper
                  }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_2_status_charging', rounded=True) | upper
                  }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center>Discharge : <b> {% if
                  states('binary_sensor.yambms_jk_bms_2_status_discharging', rounded=True) ==
                  'on' %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_2_status_discharging', rounded=True) |
                  upper }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_2_status_discharging', rounded=True) |
                  upper }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center>Balance : <b> {% if
                  states('binary_sensor.yambms_jk_bms_2_status_balancing', rounded=True) ==
                  'on' %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_2_status_balancing', rounded=True) |
                  upper }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_2_status_balancing', rounded=True) |
                  upper }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_2_battery_voltage', rounded=True) }}
                  V</font></b>
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_2_battery_current', rounded=True) }} A</font></b>
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_2_battery_power', rounded=True) }} W</font>
          - type: grid
            square: false
            columns: 2
            cards:
              - type: markdown
                content: >-
                  <center><b><font size=4>SoC :&nbsp;&nbsp;<font
                  color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_2_battery_soc', rounded=True) }}
                  %</font></font>
              - type: markdown
                content: >-
                  <center><b><font size=4>SoH :&nbsp;&nbsp;<font
                  color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_2_battery_soh_valuation', rounded=True) }}
                  %</font></font>
              - type: markdown
                content: >-
                  <center> Battery Capacity :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('number.yambms_jk_bms_2_battery_capacity_total_setting', rounded=True)
                  }} Ah</font><br> Cycle Capacity :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_total_charging_cycle_capacity', rounded=True)
                  }} Ah</font><br> Ave. Cell Vol. :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_cell_average_voltage', rounded=True) }}
                  V</font><br> Balance Cur. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_balancing_current', rounded=True) }}
                  A</font><br> Max temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_max_temperature', rounded=True) }}
                  C</font>
              - type: markdown
                content: >-
                  <center> Remain Capacity :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_battery_capacity_remaining', rounded=True) }}
                  Ah</font><br> Cycle Count :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_charging_cycles', rounded=True)
                  }}</font><br> Delta Cell Vol. :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_cell_delta_voltage', rounded=True) }}
                  V</font><br> MOS temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_temperature_powertube', rounded=True)
                  }} C</font><br> Min temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_2_min_temperature', rounded=True) }}
                  C</font>
          - type: grid
            square: false
            columns: 2
            cards:
              - type: markdown
                content: >-
                  
                  {% macro cell_v(num, entity, max_color = 'red' , min_color = '#3090C9', lead_zero = 0, spaces=3) -%}
                  {% if lead_zero %}0{% endif %}{{num}}.{% for spaces in range(0, spaces) -%} {{ '&nbsp;' }} {%- endfor %}
                  {% if states('sensor{}_cell_voltage_max_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ max_color }}'>
                  {% elif states('sensor{}_cell_voltage_min_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ min_color }}'>
                  {% else %} <font> {% endif %}
                  
                  {{ states('sensor{}_cell_voltage_{}{}'.format(entity, ''.zfill(lead_zero), num), rounded=True) }} V</font>
                  {% if has_value('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num)) %} / 
                  {{ states('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num) , rounded=True) }}  {% endif %}
                  <br>
                  
                  {% endmacro %}
                  
                  <center>
                  
                  {{ cell_v(lead_zero=1, num=1, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=1, num=2, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=1, num=3, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=1, num=4, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=1, num=5, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=1, num=6, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=1, num=7, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=1, num=8, entity='.yambms_jk_bms_2') }}                  
                  
                  </center>
              - type: markdown
                content: >-
                  
                  {% macro cell_v(num, entity, max_color = 'red' , min_color = '#3090C9', lead_zero = 0, spaces=3) -%}
                  {% if lead_zero %}0{% endif %}{{num}}.{% for spaces in range(0, spaces) -%} {{ '&nbsp;' }} {%- endfor %}
                  {% if states('sensor{}_cell_voltage_max_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ max_color }}'>
                  {% elif states('sensor{}_cell_voltage_min_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ min_color }}'>
                  {% else %} <font> {% endif %}
                  
                  {{ states('sensor{}_cell_voltage_{}{}'.format(entity, ''.zfill(lead_zero), num), rounded=True) }} V</font>
                  {% if has_value('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num)) %} / 
                  {{ states('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num) , rounded=True) }}  {% endif %}
                  <br>
                  
                  {% endmacro %}
                  
                  <center>
                  
                  {{ cell_v(lead_zero=1, num=9, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=0, num=10, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=0, num=11, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=0, num=12, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=0, num=13, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=0, num=14, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=0, num=15, entity='.yambms_jk_bms_2') }}
                  {{ cell_v(lead_zero=0, num=16, entity='.yambms_jk_bms_2') }}              
                  
                  </center>
          - type: entity-filter
            entities:
              - entity: switch.yambms_jk_bms_2_charge_switch
                name: Charge switch
              - entity: switch.yambms_jk_bms_2_discharge_switch
                name: Discharge switch
              - entity: switch.yambms_jk_bms_2_balance_switch
                name: Balance switch
              - entity: switch.yambms_jk_bms_2_enable_bluetooth_connection
                name: Bluetooth
              - entity: number.yambms_jk_bms_2_charging_cycles_offset
                name: Charging Cycles Offset
            conditions:
              - condition: state
                state_not: unavailable
      - type: grid
        column_span: 1
        cards:
          - type: heading
            heading: BMS 3
            heading_style: title
            badges:
              - type: entity
                show_state: true
                show_icon: true
                entity: binary_sensor.yambms_jk_bms_3_status_online
                color: state
                name: Online
                state_content: name
              - type: entity
                show_state: true
                show_icon: true
                entity: binary_sensor.yambms_jk_bms_3_can_be_combined
                color: state
                name: Combined
                state_content: name
          - type: grid
            square: false
            columns: 1
            cards:
              - type: markdown
                content: >-
                  <center>Time : <b><font color=red>{{
                  states('sensor.yambms_jk_bms_3_total_runtime_formatted', rounded=True)
                  | upper }}</font>
            layout_options:
              grid_columns: 2
              grid_rows: 1
          - type: grid
            square: false
            columns: 1
            cards:
              - type: markdown
                content: >-
                  <center>Error : <b><font color=red>{{
                  states('sensor.yambms_jk_bms_3_errors', rounded=True)}}</font>
            layout_options:
              grid_columns: 2
              grid_rows: 1
          - type: grid
            square: false
            columns: 3
            cards:
              - type: markdown
                content: >-
                  <center>Charge : <b>{% if
                  states('binary_sensor.yambms_jk_bms_3_status_charging', rounded=True) == 'on'
                  %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_3_status_charging', rounded=True) | upper
                  }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_3_status_charging', rounded=True) | upper
                  }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center>Discharge : <b> {% if
                  states('binary_sensor.yambms_jk_bms_3_status_discharging', rounded=True) ==
                  'on' %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_3_status_discharging', rounded=True) |
                  upper }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_3_status_discharging', rounded=True) |
                  upper }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center>Balance : <b> {% if
                  states('binary_sensor.yambms_jk_bms_3_status_balancing', rounded=True) ==
                  'on' %} <font color=#41CD52>{{
                  states('binary_sensor.yambms_jk_bms_3_status_balancing', rounded=True) |
                  upper }}</font> {% else %} <font color=#3090C7>{{
                  states('binary_sensor.yambms_jk_bms_3_status_balancing', rounded=True) |
                  upper }}</font> {% endif %}
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_3_battery_voltage', rounded=True) }}
                  V</font></b>
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_3_battery_current', rounded=True) }} A</font></b>
              - type: markdown
                content: >-
                  <center><b><font color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_3_battery_power', rounded=True) }} W</font>
          - type: grid
            square: false
            columns: 2
            cards:
              - type: markdown
                content: >-
                  <center><b><font size=4>SoC :&nbsp;&nbsp;<font
                  color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_3_battery_soc', rounded=True) }}
                  %</font></font>
              - type: markdown
                content: >-
                  <center><b><font size=4>SoH :&nbsp;&nbsp;<font
                  color=#41CD52 size=4>{{
                  states('sensor.yambms_jk_bms_3_battery_soh_valuation', rounded=True) }}
                  %</font></font>
              - type: markdown
                content: >-
                  <center> Battery Capacity :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('number.yambms_jk_bms_3_battery_capacity_total_setting', rounded=True)
                  }} Ah</font><br> Cycle Capacity :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_total_charging_cycle_capacity', rounded=True)
                  }} Ah</font><br> Ave. Cell Vol. :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_cell_average_voltage', rounded=True) }}
                  V</font><br> Balance Cur. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_balancing_current', rounded=True) }}
                  A</font><br> Max temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_max_temperature', rounded=True) }}
                  C</font>
              - type: markdown
                content: >-
                  <center> Remain Capacity :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_battery_capacity_remaining', rounded=True) }}
                  Ah</font><br> Cycle Count :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_charging_cycles', rounded=True)
                  }}</font><br> Delta Cell Vol. :&nbsp;&nbsp;<font
                  color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_cell_delta_voltage', rounded=True) }}
                  V</font><br> MOS temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_temperature_powertube', rounded=True)
                  }} C</font><br> Min temp. :&nbsp;&nbsp;<font color=#41CD52>{{
                  states('sensor.yambms_jk_bms_3_min_temperature', rounded=True) }}
                  C</font>
          - type: grid
            square: false
            columns: 2
            cards:
              - type: markdown
                content: >-
                  
                  {% macro cell_v(num, entity, max_color = 'red' , min_color = '#3090C9', lead_zero = 0, spaces=3) -%}
                  {% if lead_zero %}0{% endif %}{{num}}.{% for spaces in range(0, spaces) -%} {{ '&nbsp;' }} {%- endfor %}
                  {% if states('sensor{}_cell_voltage_max_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ max_color }}'>
                  {% elif states('sensor{}_cell_voltage_min_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ min_color }}'>
                  {% else %} <font> {% endif %}
                  
                  {{ states('sensor{}_cell_voltage_{}{}'.format(entity, ''.zfill(lead_zero), num), rounded=True) }} V</font>
                  {% if has_value('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num)) %} / 
                  {{ states('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num) , rounded=True) }}  {% endif %}
                  <br>
                  
                  {% endmacro %}
                  
                  <center>
                  
                  {{ cell_v(lead_zero=1, num=1, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=1, num=2, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=1, num=3, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=1, num=4, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=1, num=5, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=1, num=6, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=1, num=7, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=1, num=8, entity='.yambms_jk_bms_3') }}                  
                  
                  </center>
              - type: markdown
                content: >-
                  
                  {% macro cell_v(num, entity, max_color = 'red' , min_color = '#3090C9', lead_zero = 0, spaces=3) -%}
                  {% if lead_zero %}0{% endif %}{{num}}.{% for spaces in range(0, spaces) -%} {{ '&nbsp;' }} {%- endfor %}
                  {% if states('sensor{}_cell_voltage_max_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ max_color }}'>
                  {% elif states('sensor{}_cell_voltage_min_cell_number'.format(entity), rounded=True) == '{}'.format(num) %}
                  <font color='{{ min_color }}'>
                  {% else %} <font> {% endif %}
                  
                  {{ states('sensor{}_cell_voltage_{}{}'.format(entity, ''.zfill(lead_zero), num), rounded=True) }} V</font>
                  {% if has_value('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num)) %} / 
                  {{ states('sensor{}_cell_resistance_{}{}'.format(entity, ''.zfill(lead_zero), num) , rounded=True) }}  {% endif %}
                  <br>
                  
                  {% endmacro %}
                  
                  <center>
                  
                  {{ cell_v(lead_zero=1, num=9, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=0, num=10, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=0, num=11, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=0, num=12, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=0, num=13, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=0, num=14, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=0, num=15, entity='.yambms_jk_bms_3') }}
                  {{ cell_v(lead_zero=0, num=16, entity='.yambms_jk_bms_3') }}              
                  
                  </center>
          - type: entity-filter
            entities:
              - entity: switch.yambms_jk_bms_3_charge_switch
                name: Charge switch
              - entity: switch.yambms_jk_bms_3_discharge_switch
                name: Discharge switch
              - entity: switch.yambms_jk_bms_3_balance_switch
                name: Balance switch
              - entity: switch.yambms_jk_bms_3_enable_bluetooth_connection
                name: Bluetooth
              - entity: number.yambms_jk_bms_3_charging_cycles_offset
                name: Charging Cycles Offset
            conditions:
              - condition: state
                state_not: unavailable
  - title: Shunt
    type: sections
    max_columns: 3
    sections:
      - type: grid
        cards:
          - graph: line
            type: sensor
            entity: sensor.yambms_shunt_1_voltage
            detail: 2
            layout_options:
              grid_columns: 2
              grid_rows: 2
            name: Voltage
            hours_to_show: 8
          - graph: line
            type: sensor
            entity: sensor.yambms_shunt_1_state_of_charge
            detail: 2
            name: SoC
            hours_to_show: 8
          - type: gauge
            entity: sensor.yambms_shunt_1_current
            needle: true
            severity:
              green: 0
              yellow: -250
              red: -500
            max: 500
            min: -500
            name: Current
            layout_options:
              grid_columns: 2
              grid_rows: 3
          - type: gauge
            entity: sensor.yambms_shunt_1_power
            needle: true
            severity:
              green: 0
              yellow: -2500
              red: -5000
            max: 5000
            min: -5000
            name: Power
            layout_options:
              grid_columns: 2
              grid_rows: 3
          - type: entity-filter
            entities:
              - entity: sensor.yambms_shunt_1_voltage
                name: Shunt 1 Voltage
              - entity: sensor.yambms_shunt_1_current
                name: Shunt 1 Current
              - entity: sensor.yambms_shunt_1_power
                name: Shunt 1 Power
              - entity: sensor.yambms_shunt_1_state_of_charge
                name: Shunt 1 SoC
              - entity: sensor.yambms_shunt_1_temperature
                name: Shunt 1 Temperature
              - entity: sensor.yambms_shunt_1_charged_power
                name: Shunt 1 Charged Power
              - entity: sensor.yambms_shunt_1_discharged_power
                name: Shunt 1 Discharged Power
              - entity: sensor.yambms_shunt_1_battery_capacity
                name: Shunt 1 Battery Capacity
            conditions:
              - condition: state
                state_not: unavailable
          - type: entities
            entities:
              - entity: switch.yambms_shunt_1_combine_enabled
                name: Shunt 1 Combine enabled
              - entity: binary_sensor.yambms_shunt_1_can_be_combined
                name: Shunt 1 Can be combined
        title: Shunt 1
        column_span: 1
title: My Dashboard
